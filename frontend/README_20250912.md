# AI 기반 스토리→이미지→영상 제작 워크플로우 툴 v2.0

## 📋 프로젝트 개요 (2025-09-12 기준)

AI 기반 프로젝트 파이프라인 툴로, **스토리 입력 → 캐릭터/배경 이미지 생성 → 컷별 영상 생성**까지의 전체 워크플로우를 관리하는 웹 애플리케이션입니다.

### 🎯 핵심 워크플로우
```
스토리 입력 → AI 텍스트 생성 → 이미지 생성 → 영상 생성
     ↓              ↓              ↓           ↓
  기본 설정    →  프롬프트 생성  →  AI 이미지  →  컷별 영상
  캐릭터 설정     시나리오 생성     배경/설정컷    최종 영상
```

## 🏗️ 현재 아키텍처 분석

### 1. 파일 구조 현황
```
frontend/
├── src/
│   ├── App.tsx                 # 🚨 메인 컴포넌트 (3908줄) - 리팩토링 필요
│   ├── components/
│   │   ├── common/
│   │   │   ├── Button.tsx      # 재사용 가능한 버튼 컴포넌트
│   │   │   ├── Modal.tsx       # 모달 컴포넌트
│   │   │   ├── ImageUpload.tsx # 이미지 업로드 컴포넌트
│   │   │   ├── ProgressTracker.tsx # 진행률 추적기
│   │   │   └── StreamingText.tsx # 스트리밍 텍스트 컴포넌트
│   │   └── steps/              # 단계별 컴포넌트 (미사용)
│   ├── services/
│   │   ├── googleAIService.ts  # Google AI 통합 서비스
│   │   ├── api.ts             # API 서비스
│   │   ├── characterService.ts # 캐릭터 관련 서비스
│   │   ├── videoService.ts    # 영상 관련 서비스
│   │   └── mockApi.ts         # 목업 API
│   ├── stores/
│   │   ├── projectStore.ts    # 프로젝트 상태 관리
│   │   └── uiStore.ts         # UI 상태 관리
│   ├── types/
│   │   ├── project.ts         # 프로젝트 타입 정의
│   │   ├── common.ts          # 공통 타입 정의
│   │   └── api.ts             # API 타입 정의
│   └── utils/
│       ├── constants.ts       # 상수 정의
│       ├── helpers.ts         # 유틸리티 함수
│       └── downloadUtils.ts   # 다운로드 유틸리티
```

### 2. 현재 기능 구현 상태

#### ✅ 완료된 기능
- **프로젝트 개요**: AI 텍스트 생성 (스토리, 캐릭터, 시나리오)
- **이미지 생성**: Google AI Studio를 통한 이미지 생성
- **영상 생성**: 컷별 영상 생성 및 관리
- **상태 관리**: Zustand를 통한 전역 상태 관리
- **UI/UX**: 반응형 디자인 및 진행률 추적

#### ⚠️ 개선이 필요한 부분
- **App.tsx 거대화**: 3908줄의 단일 파일로 인한 유지보수 어려움
- **컴포넌트 분리 부족**: steps 폴더의 컴포넌트들이 미사용
- **AI 서비스 단일화**: Google AI만 지원, 확장성 부족
- **데이터 저장**: 로컬 상태만 사용, 영구 저장 불가

## 🔧 기능별 상세 분석

### 1. 프로젝트 개요 단계
```typescript
// 현재 구현 상태
const [story, setStory] = useState("");
const [characterList, setCharacterList] = useState([]);
const [scenarioPrompt, setScenarioPrompt] = useState("");

// AI 생성 함수들
const handleGenerateAllPrompts = async () => {
  // 통합 AI 생성 로직
};
const handleGenerateCharacterPrompt = async () => {
  // 캐릭터 프롬프트 생성
};
```

**개선점**:
- 각 단계별 컴포넌트로 분리 필요
- AI 서비스 추상화 필요
- 에러 처리 강화 필요

### 2. 이미지 생성 단계
```typescript
// 현재 Google AI Studio만 지원
const handleGenerateCharacter = async () => {
  const imageResult = await googleAIService.generateCharacterImage(imagePrompt);
  // 이미지 생성 로직
};
```

**개선점**:
- 다중 AI 서비스 지원 필요
- 이미지 품질 설정 옵션 필요
- 배치 처리 기능 필요

### 3. 영상 생성 단계
```typescript
// 현재 컷별 영상 생성
const handleGenerateAIVideo = async () => {
  const videoResult = await googleAIService.generateVideo(prompt, videoRatio);
  // 영상 생성 로직
};
```

**개선점**:
- 영상 품질 설정 필요
- 배치 처리 최적화 필요
- 진행률 표시 개선 필요

## 🚀 개선 방향 및 구현 방법

### 1. AI 서비스 확장 (다중 AI 지원)

#### 현재 구조
```typescript
// services/googleAIService.ts
export class GoogleAIService {
  async generateText(prompt: string): Promise<string> { }
  async generateImage(prompt: string): Promise<string> { }
  async generateVideo(prompt: string): Promise<string> { }
}
```

#### 개선된 구조
```typescript
// services/ai/BaseAIService.ts
export abstract class BaseAIService {
  abstract generateText(prompt: string): Promise<string>;
  abstract generateImage(prompt: string): Promise<string>;
  abstract generateVideo(prompt: string): Promise<string>;
}

// services/ai/GoogleAIService.ts
export class GoogleAIService extends BaseAIService {
  // Google AI 구현
}

// services/ai/OpenAIService.ts
export class OpenAIService extends BaseAIService {
  // OpenAI 구현
}

// services/ai/AIServiceFactory.ts
export class AIServiceFactory {
  static createService(provider: 'google' | 'openai'): BaseAIService {
    switch(provider) {
      case 'google': return new GoogleAIService();
      case 'openai': return new OpenAIService();
      default: throw new Error('Unsupported AI provider');
    }
  }
}
```

#### 설정 파일 추가
```typescript
// config/aiConfig.ts
export const AI_CONFIG = {
  providers: {
    google: {
      apiKey: process.env.REACT_APP_GEMINI_API_KEY,
      models: {
        text: 'gemini-2.5-flash',
        image: 'imagen-4.0-generate-001',
        video: 'veo-3.0-generate-preview'
      }
    },
    openai: {
      apiKey: process.env.REACT_APP_OPENAI_API_KEY,
      models: {
        text: 'gpt-4',
        image: 'dall-e-3',
        video: 'sora' // 향후 지원 예정
      }
    }
  }
};
```

### 2. 데이터 저장 시스템 비교

#### SQLite 방식 (권장)
```typescript
// database/sqlite.ts
import Database from 'better-sqlite3';

export class SQLiteDatabase {
  private db: Database.Database;
  
  constructor() {
    this.db = new Database('storyboard.db');
    this.initTables();
  }
  
  private initTables() {
    this.db.exec(`
      CREATE TABLE IF NOT EXISTS projects (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        description TEXT,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
      );
      
      CREATE TABLE IF NOT EXISTS project_steps (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        project_id INTEGER,
        step_type TEXT NOT NULL,
        step_data TEXT NOT NULL,
        FOREIGN KEY (project_id) REFERENCES projects (id)
      );
    `);
  }
  
  saveProject(project: Project): number {
    const stmt = this.db.prepare(`
      INSERT INTO projects (name, description) VALUES (?, ?)
    `);
    return stmt.run(project.name, project.description).lastInsertRowid;
  }
  
  loadProject(id: number): Project | null {
    const stmt = this.db.prepare(`
      SELECT * FROM projects WHERE id = ?
    `);
    return stmt.get(id);
  }
}
```

#### 파일 저장 방식
```typescript
// storage/fileStorage.ts
import fs from 'fs/promises';
import path from 'path';

export class FileStorage {
  private baseDir = './data/projects';
  
  async saveProject(project: Project): Promise<string> {
    const filename = `${project.id}.json`;
    const filepath = path.join(this.baseDir, filename);
    await fs.writeFile(filepath, JSON.stringify(project, null, 2));
    return filepath;
  }
  
  async loadProject(id: string): Promise<Project | null> {
    const filename = `${id}.json`;
    const filepath = path.join(this.baseDir, filename);
    try {
      const data = await fs.readFile(filepath, 'utf-8');
      return JSON.parse(data);
    } catch {
      return null;
    }
  }
}
```

#### 비교 분석
| 항목 | SQLite | 파일 저장 |
|------|--------|-----------|
| **성능** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| **검색** | ⭐⭐⭐⭐⭐ | ⭐⭐ |
| **백업** | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **복잡성** | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **확장성** | ⭐⭐⭐⭐⭐ | ⭐⭐ |

**권장사항**: SQLite 방식 채택
- 프로젝트 검색 및 필터링 기능
- 메타데이터 관리 용이
- 향후 웹 서버 연동 시 데이터베이스 마이그레이션 용이

### 3. 코드 리팩토링 방향

#### 현재 문제점
- **App.tsx 거대화**: 3908줄의 단일 파일
- **컴포넌트 분리 부족**: UI 로직과 비즈니스 로직 혼재
- **재사용성 부족**: 중복 코드 다수 존재

#### 개선된 구조
```
src/
├── components/
│   ├── layout/
│   │   ├── Header.tsx
│   │   ├── Sidebar.tsx
│   │   └── MainContent.tsx
│   ├── steps/
│   │   ├── ProjectOverview/
│   │   │   ├── index.tsx
│   │   │   ├── StoryInput.tsx
│   │   │   ├── CharacterInput.tsx
│   │   │   └── ScenarioInput.tsx
│   │   ├── ImageGeneration/
│   │   │   ├── index.tsx
│   │   │   ├── CharacterGeneration.tsx
│   │   │   ├── BackgroundGeneration.tsx
│   │   │   └── SettingCutGeneration.tsx
│   │   └── VideoGeneration/
│   │       ├── index.tsx
│   │       ├── TextCardGeneration.tsx
│   │       ├── VideoThumbnailGeneration.tsx
│   │       └── VideoCreation.tsx
│   └── common/
│       ├── Card.tsx
│       ├── Input.tsx
│       ├── Button.tsx
│       └── Modal.tsx
├── hooks/
│   ├── useProject.ts
│   ├── useAIService.ts
│   └── useStorage.ts
├── services/
│   ├── ai/
│   │   ├── BaseAIService.ts
│   │   ├── GoogleAIService.ts
│   │   └── OpenAIService.ts
│   └── storage/
│       ├── DatabaseService.ts
│       └── FileStorageService.ts
└── utils/
    ├── constants.ts
    ├── helpers.ts
    └── validation.ts
```

#### 단계별 리팩토링 계획

**1단계: 컴포넌트 분리**
```typescript
// components/steps/ProjectOverview/index.tsx
export const ProjectOverviewStep = () => {
  const { project, updateProject } = useProject();
  const { generateText } = useAIService();
  
  return (
    <div className="space-y-6">
      <StoryInput 
        value={project.story}
        onChange={(story) => updateProject({ story })}
        onGenerate={generateText}
      />
      <CharacterInput 
        characters={project.characters}
        onUpdate={updateProject}
      />
      <ScenarioInput 
        scenario={project.scenario}
        onUpdate={updateProject}
      />
    </div>
  );
};
```

**2단계: 커스텀 훅 분리**
```typescript
// hooks/useProject.ts
export const useProject = () => {
  const [project, setProject] = useState<Project>(initialProject);
  const { saveProject, loadProject } = useStorage();
  
  const updateProject = useCallback((updates: Partial<Project>) => {
    setProject(prev => ({ ...prev, ...updates }));
  }, []);
  
  const save = useCallback(async () => {
    await saveProject(project);
  }, [project, saveProject]);
  
  return { project, updateProject, save };
};
```

**3단계: 서비스 레이어 분리**
```typescript
// services/ProjectService.ts
export class ProjectService {
  constructor(
    private aiService: BaseAIService,
    private storageService: BaseStorageService
  ) {}
  
  async generateProjectOverview(input: ProjectInput): Promise<ProjectOverview> {
    const story = await this.aiService.generateText(input.story);
    const characters = await this.aiService.generateText(input.characters);
    const scenario = await this.aiService.generateText(input.scenario);
    
    return { story, characters, scenario };
  }
  
  async saveProject(project: Project): Promise<void> {
    await this.storageService.save(project);
  }
}
```

## 📊 구현 우선순위

### Phase 1: 기본 리팩토링 (2주)
1. **App.tsx 분리**: 단계별 컴포넌트로 분리
2. **커스텀 훅 생성**: 비즈니스 로직 분리
3. **타입 정의 강화**: TypeScript 타입 안정성 향상

### Phase 2: AI 서비스 확장 (2주)
1. **BaseAIService 인터페이스**: AI 서비스 추상화
2. **OpenAI 서비스 추가**: 다중 AI 지원
3. **AI 서비스 팩토리**: 동적 AI 서비스 선택

### Phase 3: 데이터 저장 시스템 (1주)
1. **SQLite 데이터베이스**: 프로젝트 영구 저장
2. **데이터 마이그레이션**: 기존 데이터 이전
3. **백업/복원 기능**: 데이터 안전성 확보

### Phase 4: 고급 기능 (2주)
1. **프로젝트 템플릿**: 재사용 가능한 템플릿 시스템
2. **배치 처리**: 대량 이미지/영상 생성
3. **진행률 표시**: 실시간 생성 진행률 표시

## 🛠️ 개발 환경 설정

### 필수 요구사항
- Node.js 18.0.0 이상
- TypeScript 5.0.0 이상
- React 18.0.0 이상

### 추가 의존성
```json
{
  "dependencies": {
    "better-sqlite3": "^9.0.0",
    "openai": "^4.0.0",
    "zustand": "^4.0.0"
  },
  "devDependencies": {
    "@types/better-sqlite3": "^7.0.0",
    "eslint": "^8.0.0",
    "prettier": "^3.0.0"
  }
}
```

### 환경변수 설정
```bash
# .env
REACT_APP_GEMINI_API_KEY=your-gemini-api-key
REACT_APP_OPENAI_API_KEY=your-openai-api-key
REACT_APP_DATABASE_PATH=./data/storyboard.db
```

## 📈 성능 최적화 방향

### 1. 코드 분할 (Code Splitting)
```typescript
// App.tsx
const ProjectOverview = lazy(() => import('./components/steps/ProjectOverview'));
const ImageGeneration = lazy(() => import('./components/steps/ImageGeneration'));
const VideoGeneration = lazy(() => import('./components/steps/VideoGeneration'));
```

### 2. 메모이제이션
```typescript
// 컴포넌트 메모이제이션
const CharacterCard = memo(({ character, onUpdate, onDelete }) => {
  // 컴포넌트 로직
});

// 계산 메모이제이션
const expensiveValue = useMemo(() => {
  return heavyCalculation(data);
}, [data]);
```

### 3. 가상화 (Virtualization)
```typescript
// 대량 데이터 렌더링 최적화
import { FixedSizeList as List } from 'react-window';

const VideoList = ({ videos }) => (
  <List
    height={600}
    itemCount={videos.length}
    itemSize={200}
    itemData={videos}
  >
    {VideoItem}
  </List>
);
```

## 🔒 보안 고려사항

### 1. API 키 보안
- 환경변수 사용
- 클라이언트 사이드 노출 방지
- API 키 로테이션 정책

### 2. 데이터 보안
- SQLite 데이터베이스 암호화
- 사용자 데이터 익명화
- 백업 데이터 암호화

### 3. 입력 검증
- XSS 공격 방지
- SQL 인젝션 방지
- 파일 업로드 검증

## 📝 테스트 전략

### 1. 단위 테스트
```typescript
// __tests__/components/Button.test.tsx
import { render, fireEvent } from '@testing-library/react';
import { Button } from '../Button';

test('버튼 클릭 시 콜백 호출', () => {
  const handleClick = jest.fn();
  render(<Button onClick={handleClick}>클릭</Button>);
  fireEvent.click(screen.getByText('클릭'));
  expect(handleClick).toHaveBeenCalledTimes(1);
});
```

### 2. 통합 테스트
```typescript
// __tests__/services/AIService.test.tsx
import { GoogleAIService } from '../services/ai/GoogleAIService';

test('텍스트 생성 기능', async () => {
  const service = new GoogleAIService();
  const result = await service.generateText('테스트 프롬프트');
  expect(result).toBeDefined();
  expect(typeof result).toBe('string');
});
```

### 3. E2E 테스트
```typescript
// cypress/integration/project-workflow.spec.ts
describe('프로젝트 워크플로우', () => {
  it('스토리 입력부터 영상 생성까지', () => {
    cy.visit('/');
    cy.get('[data-testid="story-input"]').type('테스트 스토리');
    cy.get('[data-testid="generate-story"]').click();
    // ... 전체 워크플로우 테스트
  });
});
```

## 🚀 배포 전략

### 1. 개발 환경
- 로컬 개발 서버
- SQLite 데이터베이스
- Mock API 서비스

### 2. 스테이징 환경
- Docker 컨테이너
- PostgreSQL 데이터베이스
- 실제 AI 서비스 연동

### 3. 프로덕션 환경
- 클라우드 배포 (AWS/GCP)
- 관리형 데이터베이스
- CDN 및 캐싱

## 📚 학습 리소스

### 주니어 개발자를 위한 가이드
1. **React 컴포넌트 분리**: [React 공식 문서](https://react.dev/learn)
2. **TypeScript 타입 시스템**: [TypeScript 핸드북](https://www.typescriptlang.org/docs/)
3. **상태 관리**: [Zustand 가이드](https://github.com/pmndrs/zustand)
4. **AI 서비스 통합**: [OpenAI API 문서](https://platform.openai.com/docs)

### 코드 리뷰 체크리스트
- [ ] 컴포넌트가 단일 책임 원칙을 따르는가?
- [ ] 타입 정의가 명확하고 안전한가?
- [ ] 에러 처리가 적절히 구현되었는가?
- [ ] 성능 최적화가 고려되었는가?
- [ ] 테스트 코드가 작성되었는가?

---

**문서 작성일**: 2025-09-12  
**버전**: v2.0  
**작성자**: AI Assistant  
**다음 업데이트**: 2025-09-26
